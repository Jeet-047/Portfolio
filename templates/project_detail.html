<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.title }} | Project Details</title>
    <link rel="icon" href="/static/favicon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .slider-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #000;
            border-radius: 1.5rem;
            overflow: hidden;
        }

        .slider-wrapper {
            display: flex;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .slider-wrapper.no-transition {
            transition: none;
        }

        .slide-item {
            flex: 0 0 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .slide-item img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            object-position: center;
            display: block;
        }

        .slider-dots {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .slider-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgb(100, 100, 100);
            border: 2px solid rgb(187, 169, 169);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: #22d3ee;
            border-color: #22d3ee;
            width: 30px;
            border-radius: 5px;
        }

        .slider-dot:hover {
            background: rgba(34, 211, 238, 0.6);
        }

        .feature-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.8));
            border-left: 3px solid #22d3ee;
            transition: transform 0.2s ease;
        }

        .feature-card:hover {
            transform: translateX(5px);
            background: linear-gradient(145deg, rgba(34, 211, 238, 0.1), rgba(15, 23, 42, 0.8));
        }

        .overview-accent {
            position: relative;
            padding-left: 2rem;
            padding-right: 1rem;
            text-align: justify;
        }

        .overview-accent::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #22d3ee, transparent);
            border-radius: 2px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased">

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-20">
        
        <!-- Back Navigation -->
        <div class="mb-8">
            <a href="/projects" class="inline-flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors group">
                <i class="fas fa-arrow-left transition-transform group-hover:-translate-x-1"></i>
                <span class="font-medium">Return to Projects</span>
            </a>
        </div>

        <!-- Header Info -->
        <div class="mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-3 tracking-tight">{{ project.title }}</h1>
            <p class="text-xl text-slate-400 max-w-3xl leading-relaxed text-justify">{{ project.short_desc }}</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <!-- Media Section -->
            <div class="lg:col-span-8">
                <div class="slider-container shadow-2xl border border-slate-800" id="slider-container">
                    <div class="slider-wrapper" id="slider-wrapper">
                        {% if project.images and project.images|length > 1 %}
                            <!-- Clone of last image for infinite loop -->
                            <div class="slide-item" data-clone="last">
                                <img src="{{ project.images[-1] }}" alt="Project View">
                            </div>
                            <!-- Original images -->
                            {% for img in project.images %}
                            <div class="slide-item" data-index="{{ loop.index0 }}">
                                <img src="{{ img }}" alt="Project View {{ loop.index }}">
                            </div>
                            {% endfor %}
                            <!-- Clone of first image for infinite loop -->
                            <div class="slide-item" data-clone="first">
                                <img src="{{ project.images[0] }}" alt="Project View">
                            </div>
                        {% elif project.images %}
                            <div class="slide-item">
                                <img src="{{ project.images[0] }}" alt="Project View">
                            </div>
                        {% else %}
                            <div class="slide-item">
                                <img src="{{ project.image_url }}" alt="Project View">
                            </div>
                        {% endif %}
                    </div>
                    
                    {% if project.images and project.images|length > 1 %}
                    <button onclick="changeSlide(-1); pauseAutoSlide();" class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/50 backdrop-blur-md border border-white/10 text-white hover:bg-cyan-500 hover:text-black transition-all z-20 flex items-center justify-center">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button onclick="changeSlide(1); pauseAutoSlide();" class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/50 backdrop-blur-md border border-white/10 text-white hover:bg-cyan-500 hover:text-black transition-all z-20 flex items-center justify-center">
                        <i class="fas fa-chevron-right"></i>
                    </button>

                    <!-- Slider Dots Indicator -->
                    <div class="slider-dots">
                        {% for img in project.images %}
                        <div class="slider-dot {% if loop.index0 == 0 %}active{% endif %}" 
                             onclick="setSlide({{ loop.index0 }}); pauseAutoSlide();" 
                             data-index="{{ loop.index0 }}"></div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="absolute bottom-4 right-4 bg-black/60 px-4 py-1.5 rounded-full text-xs font-mono text-cyan-400 border border-white/10 z-20">
                        <span id="slide-index">1</span> / {{ project.images|length if project.images else 1 }}
                    </div>
                </div>

                {% if project.images and project.images|length > 1 %}
                <div class="flex gap-3 overflow-x-auto no-scrollbar mt-4">
                    {% for img in project.images %}
                    <button onclick="setSlide({{ loop.index0 }}); pauseAutoSlide();" 
                            class="flex-shrink-0 w-24 h-16 rounded-xl overflow-hidden border-2 border-transparent hover:border-cyan-400 transition-all bg-black thumbnail-btn {% if loop.index0 == 0 %}border-cyan-400{% endif %}" 
                            data-index="{{ loop.index0 }}">
                        <img src="{{ img }}" class="w-full h-full object-contain opacity-60 hover:opacity-100">
                    </button>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Project Assets Card -->
                <div class="glass-card p-6 rounded-2xl border border-slate-700/50 shadow-xl">
                    <h3 class="text-sm font-bold text-cyan-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                        <i class="fas fa-rocket"></i> Deployment & Code
                    </h3>
                    <div class="space-y-3">
                        <a href="{{ project.website_url }}" target="_blank" class="flex items-center justify-between p-4 bg-indigo-500/10 hover:bg-indigo-500/20 border border-indigo-500/20 hover:border-indigo-500/50 rounded-xl transition-all group">
                            <span class="flex items-center gap-3 text-sm font-semibold text-indigo-300">
                                <i class="fas fa-external-link-alt"></i> Live Application
                            </span>
                            <i class="fas fa-arrow-right text-xs opacity-50 group-hover:translate-x-1 transition-all"></i>
                        </a>
                        <a href="{{ project.github_url }}" target="_blank" class="flex items-center justify-between p-4 bg-slate-800/40 hover:bg-slate-700 border border-slate-700 rounded-xl transition-all group">
                            <span class="flex items-center gap-3 text-sm font-semibold text-slate-300">
                                <i class="fab fa-github text-xl"></i> Repository
                            </span>
                            <i class="fas fa-arrow-right text-xs opacity-50 group-hover:translate-x-1 transition-all"></i>
                        </a>
                    </div>
                </div>

                <!-- Project Metadata Card - MORE UNDERSTANDABLE -->
                <div class="glass-card p-6 rounded-2xl border border-slate-700/50 shadow-xl">
                    <h3 class="text-sm font-bold text-cyan-400 uppercase tracking-widest mb-5 flex items-center gap-2">
                        <i class="fas fa-fingerprint"></i> Project Snapshot
                    </h3>
                    <div class="space-y-3">
                        <div class="meta-item">
                            <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400">
                                <i class="far fa-calendar-alt"></i>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase tracking-tighter text-slate-500 font-bold">Released</p>
                                <p class="text-sm text-slate-200 font-semibold">{{ project.date }}</p>
                            </div>
                        </div>

                        <div class="meta-item">
                            <div class="w-10 h-10 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-400">
                                <i class="fas fa-user-tag text-xs"></i>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase tracking-tighter text-slate-500 font-bold">Contribution</p>
                                <p class="text-sm text-slate-200 font-semibold">{{ project.role }}</p>
                            </div>
                        </div>

                        <div class="p-4 rounded-xl bg-slate-900/50 border border-slate-800">
                            <p class="text-[10px] uppercase tracking-tighter text-slate-500 font-bold mb-3 flex items-center gap-2">
                                <i class="fas fa-layer-group"></i> Core Stack
                            </p>
                            <div class="flex flex-wrap gap-1.5">
                                {% for tech in project.technologies %}
                                <span class="px-2.5 py-1 bg-slate-800 text-slate-300 rounded text-[11px] font-medium border border-slate-700">
                                    {{ tech }}
                                </span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="lg:col-span-12 mt-12 border-t border-slate-800 pt-12">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-16">
                    <!-- Overview - MORE STYLISH -->
                    <div class="lg:col-span-2">
                        <div class="flex items-center gap-4 mb-8">
                            <h2 class="text-3xl font-bold text-white">Overview</h2>
                            <div class="h-[1px] flex-grow bg-gradient-to-r from-cyan-500/50 to-transparent"></div>
                        </div>
                        
                        <div class="overview-accent">
                            <div class="text-slate-300 text-lg leading-relaxed space-y-6">
                                {% if project.full_desc %}
                                    <div class="prose prose-invert max-w-none">
                                        {{ project.full_desc | safe }}
                                    </div>
                                {% elif project.full_description %}
                                    <p>{{ project.full_description }}</p>
                                {% else %}
                                    <p>{{ project.description }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Key Features -->
                    <div>
                        <div class="flex items-center gap-4 mb-8">
                            <h2 class="text-3xl font-bold text-white">Features</h2>
                        </div>
                        <div class="space-y-4">
                            {% for feature in project.features %}
                            <div class="feature-card p-4 rounded-xl flex items-start gap-4 shadow-lg group">
                                <div class="w-8 h-8 rounded-lg bg-cyan-400/10 flex items-center justify-center text-cyan-400 flex-shrink-0 group-hover:bg-cyan-400 group-hover:text-black transition-colors">
                                    <i class="fas fa-check text-xs"></i>
                                </div>
                                <span class="text-sm font-medium text-slate-200 leading-tight pt-1">
                                    {{ feature }}
                                </span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const images = {{ (project.images if project.images else [project.image_url]) | tojson }};
        let currentIndex = 0;
        let autoSlideInterval = null;
        const SLIDE_INTERVAL = 4000; // 4 seconds between slides
        const sliderWrapper = document.getElementById('slider-wrapper');
        const indexDisplay = document.getElementById('slide-index');
        const sliderContainer = document.getElementById('slider-container');
        let isTransitioning = false;

        const hasMultipleImages = images.length > 1;

        function updateSlider(skipTransition = false) {
            let slideIndex = currentIndex;
            let displayIndex = currentIndex;
            
            // For infinite loop: adjust index to account for clone at the beginning
            if (hasMultipleImages) {
                if (currentIndex === -1) {
                    // At clone of last image (position 0)
                    slideIndex = 0;
                    displayIndex = images.length - 1;
                } else if (currentIndex === images.length) {
                    // At clone of first image (position images.length + 1)
                    slideIndex = images.length + 1;
                    displayIndex = 0;
                } else {
                    // At a real image (position currentIndex + 1, because first is clone)
                    slideIndex = currentIndex + 1;
                    displayIndex = currentIndex;
                }
            }
            
            // Calculate the translateX value
            const translateX = -slideIndex * 100;
            
            // Apply transition control
            if (skipTransition) {
                sliderWrapper.classList.add('no-transition');
            } else {
                sliderWrapper.classList.remove('no-transition');
            }
            
            // Apply transform
            sliderWrapper.style.transform = `translateX(${translateX}%)`;
            
            // Update display index (normalize to valid range)
            const normalizedIndex = displayIndex >= 0 && displayIndex < images.length 
                ? displayIndex 
                : (displayIndex + images.length) % images.length;
            
            indexDisplay.innerText = normalizedIndex + 1;
            
            // Update indicators
            updateDots(normalizedIndex);
            updateThumbnails(normalizedIndex);

            // Handle infinite loop: jump to real image after reaching clone
            if (hasMultipleImages && !skipTransition) {
                setTimeout(() => {
                    if (currentIndex === -1) {
                        // Jump from last clone to real last image
                        currentIndex = images.length - 1;
                        updateSlider(true);
                    } else if (currentIndex === images.length) {
                        // Jump from first clone to real first image
                        currentIndex = 0;
                        updateSlider(true);
                    }
                }, 600);
            }
        }

        function updateDots(activeIndex) {
            const dots = document.querySelectorAll('.slider-dot');
            dots.forEach((dot, index) => {
                if (index === activeIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        function updateThumbnails(activeIndex) {
            const thumbnails = document.querySelectorAll('.thumbnail-btn');
            thumbnails.forEach((thumb, index) => {
                if (index === activeIndex) {
                    thumb.classList.add('border-cyan-400');
                } else {
                    thumb.classList.remove('border-cyan-400');
                }
            });
        }

        function changeSlide(direction) {
            if (isTransitioning && hasMultipleImages) {
                // Allow if it's been stuck for too long (safety mechanism)
                const timeSinceLastUpdate = Date.now() - (window.lastSliderUpdate || 0);
                if (timeSinceLastUpdate < 500) {
                    return;
                }
            }
            
            isTransitioning = true;
            window.lastSliderUpdate = Date.now();
            
            if (hasMultipleImages) {
                currentIndex += direction;
                
                // Handle boundaries for infinite loop
                if (currentIndex < 0) {
                    currentIndex = -1; // Go to last clone
                } else if (currentIndex >= images.length) {
                    currentIndex = images.length; // Go to first clone
                }
            } else {
                currentIndex = 0;
            }
            
            updateSlider();
            
            // Reset transitioning flag
            setTimeout(() => {
                isTransitioning = false;
            }, 650);
        }

        function setSlide(index) {
            if (isTransitioning) return;
            if (index < 0 || index >= images.length) return;
            
            isTransitioning = true;
            currentIndex = index;
            updateSlider();
            
            // Reset transitioning flag
            setTimeout(() => {
                isTransitioning = false;
            }, 600);
        }

        function startAutoSlide() {
            if (!hasMultipleImages) return;
            
            pauseAutoSlide();
            autoSlideInterval = setInterval(() => {
                if (!isTransitioning) {
                    changeSlide(1);
                }
            }, SLIDE_INTERVAL);
        }

        function pauseAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
            }
        }

        function resumeAutoSlide() {
            if (!autoSlideInterval && hasMultipleImages) {
                startAutoSlide();
            }
        }

        // Initialize slider when DOM is ready
        function initSlider() {
            if (!sliderWrapper) {
                console.error('Slider wrapper not found');
                return;
            }

            if (hasMultipleImages) {
                currentIndex = 0;
                // Set initial position at first real image (position 1, after clone)
                sliderWrapper.classList.add('no-transition');
                sliderWrapper.style.transform = 'translateX(-100%)';
                
                // Remove no-transition class after a brief delay
                setTimeout(() => {
                    sliderWrapper.classList.remove('no-transition');
                }, 100);
                
                updateDots(0);
                updateThumbnails(0);
                
                // Start auto-slide
                startAutoSlide();
                
                // Pause on hover, resume on mouse leave
                if (sliderContainer) {
                    sliderContainer.addEventListener('mouseenter', pauseAutoSlide);
                    sliderContainer.addEventListener('mouseleave', resumeAutoSlide);
                }
            } else {
                // Single image - no sliding needed
                currentIndex = 0;
                updateSlider();
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSlider);
        } else {
            initSlider();
        }
    </script>
</body>
</html>